---
title: "Megabummer"
output: html_document
---

### Data Science BIO 260 Final Project, Spring 2016
##### Allison Blajda, Leo Brown, and Emily Lisker

### Overview and Motivation

Social media users leave digital traces that can be leveraged to guide consumer purchasing decisions. Twitter users, in particular, provide temporal data that can be analyzed to develop a more precise understanding of usersâ€™ perspectives or sentiments about a service, company, or product. This information, in turn, can be shared with the public to allow customers to make decisions based on crowd-sourced knowledge. It may also even help the service provider understand how they can improve their services.

Imagine it is Friday in July and you are finishing up a long week at the office. The clock reads 4:00pm and you quickly race to pack up your work station. You need to get downtown to catch the 5pm MegaBus from NYC to Washington, DC. You are ready to start the weekend and have plans at 10pm in downtown DC. You naviate the NYC subway and break a sweat walking quickly down 42nd Street, hoping that you are early enough to score an aisle seat. As you approach the bus stop you come into view of your worst nightmare: a line with hundreds of angry Megabus passengers waiting with no bus in sight. As you walk towards the end of the line another passenger mentions that the 3:30pm bus hasn't arrived yet. A Megabus employee tells you he has no idea when the 5pm bus will depart ("Who knows.."). It is 90 degrees. You sweating profusely. You feel helpless. A wronged consumer with no recourse. Then you remember there exists a social media site called Twitter...

Based on our personal experience and the experience, we aim to analyze recent tweets to understand the degree of negative experience among users of the low-cost bus company, Megabus, over time. While Megabus is an inexpensive and convenient transportation option with many buses departing major cities each day, we hypothesize that some Megabus routes and departure times may be more reliable, i.e., busses have fewer breakdowns and delays, than others. Using social media to understanding the predictors of negative Megabus experience, we may be able to offer future bus riders information that will help them avoid these experiences. 

Our primary goal is to understand the determinants of negative experience on Megabus, with a focus on temporality, in order to provide Megabus riders with information on the likelihood of service interruptions based on date and time.


### Related Work: 

TO BE COMPLETED: Anything that inspired you, such as a paper, a web site, or something we discussed in class.

### Initial Questions: 

TO BE COMPLETED: What questions are you trying to answer? How did these questions evolve over the course of the project? What new questions did you consider in the course of your analysis?

### Data: 

#### Data Scraping and Tidying
We aimed to obtain historical tweet data in order to observe trends in tweet volume and sentiment over time and identify associations with factors such as time of year, month, and day. Since there are many factors influencing tweet volume and sentiment, we wished to obtain the largest possible data set.

Initially, we set up an app (actually, three apps, one for each of us) on the Twitter API that obtained tweets including the word "megabus." This was a great learning experience; we remember fondly this effort as our first true collaboration on git; our first exposure to the Twitter API; when we first set up an .Rprofile to store key sensitive variables; and the first tweet data we obtained. However, it became clear that the Twitter API would only provide us with tweets from the last week. This was insufficient for most of the trends we wished to consider.

A google search led us to [Jefferson Henrique's python package GetOldTweets-python](https://github.com/Jefferson-Henrique/GetOldTweets-python). This package enabled us to obtain tweets from any date (at least, we did not encounter a date that was inaccessible). The original package can be run to print tweets in the terminal. We modified the script so that it would print tweets to a csv file. As a result we obtained over 100,000 tweets from January 1, 2015 through April 1, 2016 containing the word "megabus."

We conducted much of our exploratory analysis using only tweets from the first three months of 2015. Though some questions of interest pertained to the entire 15-month period, we wanted to make sure the data frame was not too large during our exploratory phase. There was initially some evidence that the data frame was too large because some commands were slow. However, it was later identified that the only time-consuming command was an inefficiently written for loop that created several new columns. This was improved to a series of mutate() functions, and since then, wrangling the data frames takes only a few seconds from start to finish.

In order to look at variations in sentiment over days and time, we parsed the combined date and time variable into two new variables, containing just date and time information. We also used the months() function to create a month column and the weekdays() function to create a column that identified the tweet day and another to identify the tweet's status binary weekend status, with Friday counting as part of the weekend.

We cleaned the data using dplyr and the tidytext package, in order to help with the text mining tasks necessary for sentiment analysis, available here: https://github.com/juliasilge/tidytext. 

#### Sentiment Analysis
Like most sentiment analyses, we relied on a lexicon of positive and negative words. We started with the Bing lexicon in the tidytext package in the sentiment dataset (described here in more detail https://www.cs.uic.edu/~liub/). This lexicon has been compiled over the past 12 years by researchers at the University of Illinois at Chicago. 

After initial review of the Bing lexicon, we realized that we need to supplement the list of positive and negative words in order to capture the extent of Megabus transportation-specific sentiments. We added a total of 57 sentiment related to Megabus and transportation experience. These additional negative and positive words were identified  by manually reviewing a random sample from 2900 tweets containing the keyword, "megabus" queried on 4/20/2016, following methods similar to those described here: http://www.wired.com/2015/02/best-worst-public-transit-systems-according-twitter/. This review comparing the Bing lexicon with Megabus tweets also revealed that a few sentiments already in the lexicon needed to be recorded or removed. These included: changing "uneventful" from negative to positive, reversing "cheap" from negative to positive given Megabus's platform as a cheap transportation provider, and the removal of "like" which could be positive or negative and is probaby slang.

####Loading all necessary libraries
```{r}
library(dplyr)
library(ggplot2)
library(ggthemes)
library(readr)
```
####Loading and wrangling the full data set
```{r}
#Increase digits so that the many-digit tweet id does not cause a problem.
options(digits = 22) 
tweets_df_all <- read_csv("Jan_2015-April_2016.csv")
#Change the column names.
names(tweets_df_all) <- c("id","username","text","date","geo","retweets","favorites","mentions","hashtags")

#get a subset of random lines from the full set to work with:
#tweets_df_all <- tweets_df_all[sample(1:nrow(tweets_df_all), 10000, replace=FALSE),]

tweets_df_all <- tweets_df_all %>%
  mutate(time=format(date, format="%H:%M:%S")) %>%
  mutate(date2 = format(date, format="%m-%d-%y")) %>%
  mutate(month = months(as.Date(date2,'%m-%d-%y'))) %>%
  mutate(weekend = weekdays(as.Date(date2,'%m-%d-%y'))) %>%
  mutate(weekend_binary = ifelse(weekend == "Saturday"|weekend=="Sunday"|weekend=="Friday", 1, 0)) %>% 
  filter(date2 != "12-31-14") %>%
  filter(date < "2016-04-01")
# filter out duplicates
tweets_df_all <- tweets_df_all %>%
  distinct(id)
#nrow(tweets_df_all)
tweets_df_all <- tweets_df_all %>%
  distinct(text)
```
####Exploring the data set
```{r}
# explore number of tweets per user including megabus handles
prolific_tweeters_all <- tweets_df_all %>% 
  group_by(username) %>%
  summarise(tweets = n()) %>%
  arrange(desc(tweets)) 

# filter out tweets from megabus operators
tweets_df_all = tweets_df_all[!grepl("megabus|megabusuk|MegabusHelp|megabusit|megabusde|megabusGold", tweets_df_all$username),]
prolific_tweeters_filtered <- tweets_df_all %>% 
  group_by(username) %>%
  summarise(tweets = n()) %>%
  arrange(desc(tweets))

# Histogram of number of tweets
ggplot(filter(prolific_tweeters_filtered, tweets>0), aes(tweets)) + 
  geom_histogram(binwidth = 1) + xlab("Number of megabus tweets per user") + ylab("Number of users") + theme_hc()

# Histogram of number of tweets
ggplot(filter(prolific_tweeters_filtered, tweets>8), aes(tweets)) + 
  geom_histogram(binwidth = 1) + xlab("Number of megabus tweets per user") + ylab("Number of users") + theme_hc()

```

### Exploratory Analysis

TO BE COMPLETED: What visualizations did you use to look at your data in different ways? What are the different statistical methods you considered? Justify the decisions you made, and show any major changes to your ideas. How did you reach these conclusions?

```{r}

```

### Final Analysis 

TO BE COMPLETED: What did you learn about the data? How did you answer the questions? How can you justify your answers?
